# SARS-CoV-2 reinfection trends in South Africa: analysis of routine surveillance data 

This repository provides code and data for the analyses presented in:

> Pulliam, JRC, C van Schalkwyk, N Govender, A von Gottberg, C Cohen, MJ Groome, J Dushoff, K Mlisana, and H Moultrie. (2021) [_SARS-CoV-2 reinfection trends in South Africa: analysis of routine surveillance data_](https://www.medrxiv.org/content/10.1101/2021.11.11.21266068). _medRxiv_ DOI: 10.1101/2021.11.11.21266068

**The materials in this repository are made available under a CC-BY-NC 4.0 International License. See the [LICENSE](./LICENSE) file for additional information.**

## Software requirements

- R - a statistical programming language (download links for [Windows](http://cran.r-project.org/bin/windows/base/), [Linux](http://cran.r-project.org/bin/linux/), and [MacOS](http://cran.r-project.org/bin/macosx/))
- R Studio - a user interface for R that will be needed for computer exercises ([download link](http://www.rstudio.com/products/rstudio/download/))

The following packages are required to run the code in this repository (version numbers indicate the versions used for manuscript preparation):

- data.table (1.14.0)
- TO BE ADDED

## Pipeline files

The files listed below are located in the main directory:

- `Makefile` - full pipeline via GNU Make (requires use of Unix-like command line); see <https://www.gnu.org/software/make/> for more information
- `pub.json` - configuration file used for manuscript preparation
- `test.json` - test configuration file (useful to see how the code works without requiring intensive computation)
- `reinfections_pub.Rproj` - R project file, which can be used for easy file navigation in interactive mode
- `LICENSE` - license information
- `README.md` - this file
- `.gitignore` - specifies files and file types for version control to ignore

## Data files

The files listed below are located in the `data` subdirectory:

- `ts_data.csv` - national daily time series of newly detected putative primary infections (`inc_1`) and suspected reinfections (`inc_2`) by specimen receipt date (`date`)
- `demog_data.csv` - counts of putative primary infections and suspected reinfections by province, age group (5-year bands), and sex (M, F, U)

Derived data files created by certain scripts will also be placed in this subdirectory.

## Code files

The files listed below are located in the `code` subdirectory:

#### Data preparation scripts

- `prep_ts_data.R` - creates an RDS file with time series data used in analysis / plotting scripts
- MORE TO BE ADDED

Files generated by these scripts will be placed in the `data` subdirectory and will be ignored by the version control system.

#### Utility function definition scripts

- `empirical_hazard_fxn.R` - utility functions for empirical hazard estimation (approach 2)
- `fit_fxn_null.R` - utility functions for likelihood calculations (approach 1)
- `plotting_fxns.R` - utility functions for formatting plots
- `wave_defs.R` - utility functions for defining wave periods

Utility functions generated by these scripts will be placed in the `utils` subdirectory and will be ignored by the version control system.

#### Analysis and visualization scripts

- TO BE ADDED

## Output files

The files listed below are located in the `output` subdirectory:

- `posterior_90_null.RData` - posterior samples from the MCMC fitting procedure (as used in the manuscript)
- `sim_90_null.RDS` - simulation results (as used in the manuscript)

Files generated by the code in this repository will also generally be placed in this subdirectory (with exceptions as noted above).
